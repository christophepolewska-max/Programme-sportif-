<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lundi 4h – Course + Muscu (version verrouillée, clair)</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b;
    --line:#e5e7eb; --brand:#0ea5e9; --ok:#10b981; --alert:#ef4444;
    --pill:#e2e8f0; --pill-ink:#334155;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(#f8fafc,#fff);color:var(--ink)}
  a{color:#0369a1}
  .wrap{min-height:100vh;padding:16px}
  .container{max-width:1040px;margin:0 auto}
  h1{color:var(--ink);margin:0 0 6px;font-size:clamp(22px,3.5vw,30px);font-weight:800}
  .sub{color:var(--muted);font-size:14px;margin:0 0 12px}
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:12px 0 18px}
  .label{font-size:12px;color:var(--muted)}
  input[type="date"],input[type="number"],button{padding:8px 10px;border:1px solid var(--line);border-radius:12px;background:#fff;color:var(--ink)}
  button{cursor:pointer}
  .btn{border-color:#cbd5e1;background:white;color:#334155}
  .btn.primary{border-color:var(--brand);background:#e6f6fd;color:#0b4d66}
  .btn.danger{border-color:#fecaca;background:#fff1f2;color:#991b1b}
  .bar{height:8px;background:#e2e8f0;border-radius:999px;overflow:hidden}
  .bar>div{height:100%;background:var(--ok);width:0;transition:width .25s ease}
  .tiny{font-size:12px;color:var(--muted);margin:6px 0 18px}

  /* Cards */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 2px rgba(15,23,42,.06);overflow:hidden;margin-bottom:12px}
  .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px}
  .left{display:flex;gap:10px;align-items:center}
  .barv{width:6px;border-radius:3px}
  .title{font-weight:800}
  .right{display:flex;gap:8px;align-items:center}
  .pill{font-size:12px;background:var(--pill);color:var(--pill-ink);padding:4px 10px;border-radius:999px;white-space:nowrap}
  .bd{padding:0 16px 14px}
  .rows{display:grid;gap:6px;margin:8px 0}
  .row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px dashed var(--line)}
  .row:last-child{border-bottom:none}
  .lbl{color:var(--muted);font-size:13px}
  .val{font-weight:700;font-size:13px;margin-left:10px}
  .steps{margin-top:8px;border:1px dashed var(--line);border-radius:12px;padding:8px}
  .step{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;border-bottom:1px dashed var(--line);padding:6px 0}
  .step:last-child{border-bottom:none}
  .s-title{font-weight:600}
  .s-target{color:#0f766e;font-size:12px}
  .grid4{display:grid;grid-template-columns:1fr auto 120px 120px;gap:8px;align-items:center}
  .s-in{width:120px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;justify-content:flex-end}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th, td{border:1px solid var(--line);padding:8px;font-size:13px}
  th{background:#eef2f7;text-align:left}

  /* Color accents */
  .rose{background:#ef4444}.sky{background:#0ea5e9}.emerald{background:#10b981}.amber{background:#f59e0b}.slate{background:#94a3b8}
</style>
</head>
<body>
<div class="wrap">
  <div class="container">
    <header>
      <h1>Lundi 4h – Course & Musculation</h1>
      <p class="sub">Version verrouillée : échauffement & finisher <b>informative</b>, 3×500 m en <b>EF</b> (saisie des temps), puis bloc <b>salle</b> (charges). Sauvegarde locale par date.</p>
      <div class="toolbar">
        <div><div class="label">Date</div><input type="date" id="datePick" /></div>
        <button class="btn primary" id="exportCsv">Exporter CSV (historique)</button>
        <button class="btn danger" id="resetDay">Effacer valeurs du jour</button>
      </div>
      <div class="bar"><div id="progress"></div></div>
      <div class="tiny" id="progressText">Progression : 0/0 • 0%</div>
    </header>

    <!-- === COURSE: WARM-UP (INFO) === -->
    <section class="card">
      <div class="hd">
        <div class="left"><div class="barv rose"></div><div class="title">Bloc 1 — Échauffement (info)</div></div>
        <div class="right"><span class="pill" id="wupTotal">Total: —</span></div>
      </div>
      <div class="bd">
        <div class="rows">
          <div class="row"><div class="lbl">Objectif</div><div class="val">Mise en route progressive + activation cardio-musculaire</div></div>
        </div>
        <div class="steps" id="wupList"></div>
        <div class="chips" id="wupSum"></div>
      </div>
    </section>

    <!-- === COURSE: 3×500m EF (INPUTS) === -->
    <section class="card">
      <div class="hd">
        <div class="left"><div class="barv sky"></div><div class="title">Bloc 2 — 3 × 500 m (Endurance Fondamentale)</div></div>
        <div class="right"><span class="pill" id="mainTotal">Total: 0.0 min</span></div>
      </div>
      <div class="bd">
        <div class="rows">
          <div class="row"><div class="lbl">Cible</div><div class="val">Z2, technique propre, souffle maîtrisé</div></div>
          <div class="row"><div class="lbl">Récup</div><div class="val">2'30" marche entre les 500 m</div></div>
        </div>
        <div class="steps">
          <div class="step grid4">
            <div><div class="s-title">500 m — Lap 1</div><div class="s-target">Z2</div></div>
            <div class="lbl">Temps (min)</div>
            <input class="s-in" data-id="main_500_1" type="number" step="0.1">
            <input class="s-in" data-id="main_rec_1" type="number" step="0.1" placeholder="2.5" title="Récup">
          </div>
          <div class="step grid4">
            <div><div class="s-title">500 m — Lap 2</div><div class="s-target">Z2</div></div>
            <div class="lbl">Temps (min)</div>
            <input class="s-in" data-id="main_500_2" type="number" step="0.1">
            <input class="s-in" data-id="main_rec_2" type="number" step="0.1" placeholder="2.5" title="Récup">
          </div>
          <div class="step grid4">
            <div><div class="s-title">500 m — Lap 3</div><div class="s-target">Z2</div></div>
            <div class="lbl">Temps (min)</div>
            <input class="s-in" data-id="main_500_3" type="number" step="0.1">
            <div></div>
          </div>
        </div>
        <div class="chips" id="mainSum"></div>
      </div>
    </section>

    <!-- === COURSE: FINISHER (INFO) === -->
    <section class="card">
      <div class="hd">
        <div class="left"><div class="barv emerald"></div><div class="title">Bloc 3 — Finisher (info)</div></div>
        <div class="right"><span class="pill" id="finTotal">Total: —</span></div>
      </div>
      <div class="bd">
        <div class="rows">
          <div class="row"><div class="lbl">Objectif</div><div class="val">Réveiller la fréquence sans charge, garder du peps</div></div>
        </div>
        <div class="steps" id="finList"></div>
        <div class="chips" id="finSum"></div>
      </div>
    </section>

    <!-- === GYM (INPUTS) === -->
    <section class="card">
      <div class="hd">
        <div class="left"><div class="barv amber"></div><div class="title">Bloc 4 — Séance salle (après repos)</div></div>
        <div class="right"><span class="pill" id="gymDone">0/8 saisis</span></div>
      </div>
      <div class="bd">
        <div class="rows">
          <div class="row"><div class="lbl">Intention</div><div class="val">Tirage & épaules • contrôle tempo • posture</div></div>
        </div>
        <div class="steps">
          <div class="step grid4"><div><div class="s-title">Tirage vertical poulie</div><div class="s-target">4×10–12 • repos 1’30</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g1" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Développé couché haltères</div><div class="s-target">4×10 • repos 1’30</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g2" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Élévations latérales</div><div class="s-target">3×15 • repos 1’</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g3" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Développé militaire assis</div><div class="s-target">3×8–10 • repos 2’</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g4" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Curl biceps barre</div><div class="s-target">3×12 • repos 1’</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g5" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Extension triceps poulie</div><div class="s-target">3×12–15 • repos 1’</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g6" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Presse à cuisse (bonus)</div><div class="s-target">4×10 • repos 1’30</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g7" type="number" step="0.5"><div></div></div>
          <div class="step grid4"><div><div class="s-title">Crunch lesté</div><div class="s-target">3×20 • repos 45s</div></div><div class="lbl">Charge (kg)</div><input class="s-in" data-id="g8" type="number" step="0.5"><div></div></div>
        </div>
      </div>
    </section>

  </div>
</div>

<script>
// ===== Helpers & storage =====
const $=(s,r=document)=>r.querySelector(s);
const today=()=>new Date().toISOString().slice(0,10);
const LS="lundi_4h_course_gym_v1";

function readDB(){ try{ return JSON.parse(localStorage.getItem(LS)||"{}"); }catch{ return {}; } }
function writeDB(db){ localStorage.setItem(LS, JSON.stringify(db)); }
function getVal(date,key){ const db=readDB(); return db?.[date]?.[key] ?? ""; }
function setVal(date,key,val){ const db=readDB(); if(!db[date]) db[date]={}; db[date][key]=(val===""? "": Number(val)); writeDB(db); }

// ===== Info data (locked) =====
const WARMUP=[
  { t:"Footing de mise en route", d:5.0, zone:"Z2", dist:"0,5 km", note:"Petites foulées" },
  { t:"Lever de genoux", d:0.5, zone:"Z3", rec:1.0, recZone:"Z1", note:"Marche" },
  { t:"Talons/fesses", d:0.5, zone:"Z3", rec:1.0, recZone:"Z1", note:"Marche" },
  { t:"Ciseaux", d:0.5, zone:"Z3", rec:1.0, recZone:"Z1", note:"Marche" },
  { t:"Pas latéraux", d:0.5, zone:"Z3", rec:1.0, recZone:"Z1", note:"Marche" },
  { t:"Enroulé", d:0.5, zone:"Z3", rec:1.0, recZone:"Z1", note:"Marche" },
  { t:"Sprint/fréquence", d:0.5, zone:"Z5", rec:1.0, recZone:"Z1", note:"Marche" },
  { t:"Sprint/allongé", d:0.5, zone:"Z5", rec:1.0, recZone:"Z1", note:"Marche" }
];
const FINISHER=[
  { t:"Mollets / Pointes de pieds", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Fentes avant", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Fentes latérales gauche", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Fentes latérales droite", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Jump Squat", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Lever de genoux / psoas engagé", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Lever de genoux / extension abducteurs", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Étirements quadriceps / touché de sol", d:0.5, zone:"—", rec:0.5, recZone:"Z1" },
  { t:"Récupération (Appui Lap)", d:0.5, zone:"Z1", rec:0, recZone:"" }
];

function mins(x){ return (x||0).toFixed(1)+" min"; }
function renderInfoList(rootId, data){
  const root=$(rootId); root.innerHTML="";
  data.forEach(it=>{
    const d=document.createElement('div'); d.className="step";
    const left=document.createElement('div');
    left.innerHTML=`<div class="s-title">${it.t}</div><div class="s-target">Durée ${mins(it.d)} • Zone ${it.zone}${it.dist? " • Est. Distance "+it.dist:""}</div>`;
    const right=document.createElement('div'); right.className="lbl";
    right.innerHTML = it.rec!=null ? `Récup ${mins(it.rec)} ${it.recZone? "• "+it.recZone:""}${it.note? " • "+it.note:""}` : (it.note||"");
    d.append(left,right); root.append(d);
  });
}
function sumInfo(data){ let d=0,r=0; data.forEach(i=>{ d+=(i.d||0); r+=(i.rec||0); }); return {d,r,tot:d+r}; }

function sumKeys(date,keys){ return keys.reduce((a,k)=> a + (parseFloat(getVal(date,k))||0), 0); }
function countFilled(date, keys){ return keys.reduce((n,k)=> n + ((getVal(date,k)!=="")?1:0), 0); }

function refresh(){
  const d=$("#datePick").value;

  // Warm-up (display only)
  renderInfoList("#wupList", WARMUP);
  const wu=sumInfo(WARMUP);
  $("#wupTotal").textContent = "Total: " + wu.tot.toFixed(1) + " min";
  $("#wupSum").innerHTML = `<span class="pill">Dont récup: ${wu.r.toFixed(1)} min</span>`;

  // Finisher (display only)
  renderInfoList("#finList", FINISHER);
  const fi=sumInfo(FINISHER);
  $("#finTotal").textContent = "Total: " + fi.tot.toFixed(1) + " min";
  $("#finSum").innerHTML = `<span class="pill">Dont récup: ${fi.r.toFixed(1)} min</span>`;

  // Main 3x500 total
  const main = sumKeys(d, ["main_500_1","main_rec_1","main_500_2","main_rec_2","main_500_3"]);
  $("#mainTotal").textContent = "Total: " + main.toFixed(1) + " min";
  $("#mainSum").innerHTML = `<span class="pill">Récup totales: ${sumKeys(d,["main_rec_1","main_rec_2"]).toFixed(1)} min</span>`;

  // Gym counter
  let gymFilled = 0; for(let i=1;i<=8;i++){ if(getVal(d,"g"+i)!=="") gymFilled++; }
  $("#gymDone").textContent = `${gymFilled}/8 saisis`;

  // Progress bar (count inputs filled among 3x500 + 8 gym = 13 fields)
  const keys=["main_500_1","main_rec_1","main_500_2","main_rec_2","main_500_3","g1","g2","g3","g4","g5","g6","g7","g8"];
  const filled = countFilled(d, keys);
  const pct = Math.round((filled/keys.length)*100);
  $("#progress").style.width = pct+"%";
  $("#progressText").textContent = `Progression : ${filled}/${keys.length} • ${pct}%`;
}

function mount(){
  const dp=$("#datePick"); if(!dp.value) dp.value=today();
  // restore inputs
  document.querySelectorAll('input.s-in').forEach(inp=>{
    const k=inp.dataset.id;
    inp.value = getVal(dp.value,k);
    inp.onchange = ()=>{ setVal(dp.value,k,inp.value); refresh(); };
  });
  refresh();
}

function exportCsv(){
  const db=readDB(); const rows=[["date","clé","valeur"]];
  Object.keys(db).sort().forEach(d=>{ Object.keys(db[d]).forEach(k=> rows.push([d,k,db[d][k]])); });
  const csv = rows.map(r=> r.map(v=>{ const s=String(v??""); return /[\",;\n;]/.test(s)?`"${s.replace(/"/g,'""')}"`:s; }).join(";")).join("\n");
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='lundi_4h_course_gym.csv'; a.click();
}
function resetDay(){
  const d=$("#datePick").value, db=readDB(); if(!db[d]) return;
  Object.keys(db[d]).forEach(k=> db[d][k]=""); writeDB(db); mount();
}

document.addEventListener('DOMContentLoaded', ()=>{
  $("#datePick").addEventListener('change', mount);
  $("#exportCsv").addEventListener('click', exportCsv);
  $("#resetDay").addEventListener('click', resetDay);
  mount();
});
</script>
</body>
</html>
