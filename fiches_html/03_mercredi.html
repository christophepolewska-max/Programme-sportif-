!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mercredi — Matin (Calisthenie) & Soir (Pyramide)</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b;
    --line:#e5e7eb; --brand:#0ea5e9; --ok:#10b981; --alert:#ef4444;
    --pill:#e2e8f0; --pill-ink:#334155;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(#f8fafc,#fff);color:var(--ink)}
  a{color:#0369a1;text-decoration:none}
  .wrap{min-height:100vh;padding:16px}
  .container{max-width:1120px;margin:0 auto}
  h1{margin:0 0 6px;font-size:clamp(22px,3.5vw,30px);font-weight:800}
  .sub{color:var(--muted);font-size:14px;margin:0 0 12px}
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:12px 0 18px}
  .label{font-size:12px;color:var(--muted)}
  input[type="date"],input[type="number"],input[type="text"],button{padding:8px 10px;border:1px solid var(--line);border-radius:12px;background:#fff;color:var(--ink)}
  button{cursor:pointer}
  .btn{border-color:#cbd5e1;background:white;color:#334155}
  .btn.primary{border-color:var(--brand);background:#e6f6fd;color:#0b4d66}
  .btn.danger{border-color:#fecaca;background:#fff1f2;color:#991b1b}
  .bar{height:8px;background:#e2e8f0;border-radius:999px;overflow:hidden}
  .bar>div{height:100%;background:var(--ok);width:0;transition:width .25s ease}
  .tiny{font-size:12px;color:var(--muted);margin:6px 0 18px}

  /* Cards & sections */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 2px rgba(15,23,42,.06);overflow:hidden;margin-bottom:12px}
  .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer}
  .left{display:flex;gap:10px;align-items:center}
  .barv{width:6px;border-radius:3px}
  .title{font-weight:800}
  .right{display:flex;gap:8px;align-items:center}
  .pill{font-size:12px;background:var(--pill);color:var(--pill-ink);padding:4px 10px;border-radius:999px;white-space:nowrap}
  .bd{padding:0 16px 14px;display:none}
  .card.open .bd{display:block}
  .chev{width:18px;height:18px;transition:transform .2s;color:#334155}
  .card.open .chev{transform:rotate(180deg)}
  .rows{display:grid;gap:6px;margin:8px 0}
  .row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px dashed var(--line)}
  .row:last-child{border-bottom:none}
  .lbl{color:var(--muted);font-size:13px}
  .val{font-weight:700;font-size:13px;margin-left:10px}
  .steps{margin-top:8px;border:1px dashed var(--line);border-radius:12px;padding:8px}
  .step{display:grid;gap:10px;align-items:center;border-bottom:1px dashed var(--line);padding:6px 0}
  .step:last-child{border-bottom:none}
  .s-title{font-weight:600}
  .s-target{color:#0f766e;font-size:12px}
  .gridCal{grid-template-columns:1fr auto 80px 60px 60px 60px 110px}
  .gridRun{grid-template-columns:1fr auto 90px 100px 100px 100px}
  .s-in{width:100%; max-width:110px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;justify-content:flex-end}
  .note{font-size:12px;color:var(--muted);margin-top:6px}

  /* Color accents */
  .rose{background:#ef4444}.sky{background:#0ea5e9}.emerald{background:#10b981}.amber{background:#f59e0b}.slate{background:#94a3b8}

  @media (max-width:720px){
    .gridCal{grid-template-columns:1fr auto 70px 54px 54px 54px 90px}
    .gridRun{grid-template-columns:1fr auto 80px 90px 90px 90px}
  }
</style>
</head>
<body>
<nav style="position:sticky;top:0;background:#ffffffcc;backdrop-filter:saturate(180%) blur(6px);padding:10px 12px;border-bottom:1px solid #e2e8f0">
  <a href="../index.html" style="text-decoration:none;color:#0f172a">← Accueil</a>
  &nbsp;|&nbsp;
  <a href="../Planification/plan_hebdo.csv" style="text-decoration:none;color:#0f172a">Plan hebdo</a>
</nav>
<div class="wrap">
  <div class="container">
    <header>
      <h1>Mercredi — Matin (Calisthénie) & Soir (Pyramide)</h1>
      <p class="sub">Matin : calisthénie <b>marge grasse</b> (construction). Soir : fractionné pyramidal Z4 (technique). Données sauvegardées par date.</p>
      <div class="toolbar">
        <a class="btn" href="tableau_de_bord_colonne_trame.html">← Retour tableau</a>
        <div><div class="label">Date</div><input type="date" id="datePick" /></div>
        <button class="btn primary" id="exportCsv">Exporter CSV</button>
        <button class="btn danger" id="resetDay">Effacer valeurs du jour</button>
      </div>
      <div class="bar"><div id="progress"></div></div>
      <div class="tiny" id="progressText">Progression : 0/0 • 0%</div>
    </header>

    <!-- === MORNING CALISTHENICS === -->
    <section id="calis" class="card open">
      <div class="hd">
        <div class="left"><div class="barv amber"></div><div class="title">Matin — Calisthénie (marge grasse)</div></div>
        <svg class="chev" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
      </div>
      <div class="bd">
        <div class="rows">
          <div class="row"><div class="lbl">Échauffement</div><div class="val">Mobilité + 5’ cardio léger + 2×30s planche</div></div>
          <div class="row"><div class="lbl">Structure</div><div class="val">Circuit x3 • Récup 2’ entre tours</div></div>
        </div>

        <div class="steps" id="calSteps"></div>
        <div class="chips" id="calSum"></div>
        <div class="note">Règle : quand tu atteins 3×15 (ou haut de fourchette), durcir (variation, tempo, récup).</div>
      </div>
    </section>

    <!-- === EVENING RUN PYRAMID === -->
    <section id="run" class="card">
      <div class="hd">
        <div class="left"><div class="barv sky"></div><div class="title">Soir — Pyramide (Z4 technique)</div></div>
        <svg class="chev" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
      </div>
      <div class="bd">
        <div class="rows">
          <div class="row"><div class="lbl">Échauffement</div><div class="val">Footing 5’ — Z2</div></div>
          <div class="row"><div class="lbl">Paliers</div><div class="val">100 • 200 • 300 • 400 • 500 • 400 • 300 • 200 • 100 (m)</div></div>
          <div class="row"><div class="lbl">Récupérations</div><div class="val">1’ • 2’ • 3’ • 4’ • 5’ • 4’ • 3’ • 2’ • — (marche)</div></div>
        </div>

        <div class="steps" id="runSteps"></div>
        <div class="chips" id="runSum"></div>
      </div>
    </section>

  </div>
</div>

<script>
// ===== Helpers & storage =====
const $=(s,r=document)=>r.querySelector(s);
const today=()=>new Date().toISOString().slice(0,10);
const LS="mercredi_complet_v1";

function readDB(){ try{ return JSON.parse(localStorage.getItem(LS)||"{}"); }catch{ return {}; } }
function writeDB(db){ localStorage.setItem(LS, JSON.stringify(db)); }
function getVal(date,key){ const db=readDB(); return db?.[date]?.[key] ?? ""; }
function setVal(date,key,val){ const db=readDB(); if(!db[date]) db[date]={}; db[date][key]=(val===""? "": Number(val)); writeDB(db); }

// Toggle cards
document.addEventListener('click', (e)=>{
  const hd=e.target.closest('.hd'); if(!hd) return;
  const card=hd.parentElement; card.classList.toggle('open');
});

/* ===== Morning Calisthenics ===== */
const CALI = [
  {k:"A", name:"Relevés de jambes — barres parallèles", reps:"8–12", rest:"45–60", type:"reps"},
  {k:"B", name:"Tractions australiennes", reps:"8–12", rest:"45–60", type:"reps"},
  {k:"C", name:"Crunch", reps:"15–20", rest:"30–45", type:"reps"},
  {k:"D", name:"Push-up Pike", reps:"8–12", rest:"45–60", type:"reps"},
  {k:"E", name:"Suspension active (dead hang)", reps:"20s", rest:"60", type:"sec"},
  {k:"F", name:"Relevés de jambes — planche inclinée", reps:"10–15", rest:"45", type:"reps"},
  {k:"G", name:"Pompes explosives", reps:"6–10", rest:"45–60", type:"reps"},
  {k:"H", name:"Dips banc — jambes tendues", reps:"10–12", rest:"45", type:"reps"}
];

function buildCal(){
  const root=$("#calSteps"); root.innerHTML="";
  CALI.forEach((it)=>{
    const row=document.createElement('div');
    row.className="step gridCal";
    row.innerHTML=`
      <div>
        <div class="s-title">${it.name}</div>
        <div class="s-target">Cible: ${it.reps} • Repos ${it.rest}s</div>
      </div>
      <div class="lbl">S1 / S2 / S3</div>
      <input class="s-in" data-id="cal_${it.k}_1" type="number" step="1" placeholder="${it.type==='sec'?'sec':'reps'}">
      <input class="s-in" data-id="cal_${it.k}_2" type="number" step="1" placeholder="${it.type==='sec'?'sec':'reps'}">
      <input class="s-in" data-id="cal_${it.k}_3" type="number" step="1" placeholder="${it.type==='sec'?'sec':'reps'}">
      <input class="s-in" data-id="cal_${it.k}_avg" type="number" step="0.1" placeholder="moy." title="Moyenne (auto si vide)">
    `;
    root.appendChild(row);
  });
}

function calAvg(date, keyBase){
  const vals=[1,2,3].map(i => parseFloat(getVal(date, `${keyBase}_${i}`))).filter(v => !isNaN(v));
  if(!vals.length) return ""; return vals.reduce((a,b)=>a+b,0)/vals.length;
}

function calRefresh(){
  const d=$("#datePick").value;
  // fill averages if empty
  CALI.forEach(it=>{
    const avgKey=`cal_${it.k}_avg`;
    const current=getVal(d, avgKey);
    if(current==="" ){ const avg=calAvg(d, `cal_${it.k}`); if(avg!==""){ setVal(d, avgKey, avg); } }
  });
  // summary
  const done = document.querySelectorAll('#calSteps input.s-in').length;
  let filled=0; document.querySelectorAll('#calSteps input.s-in').forEach(inp=>{ if(inp.value!=="") filled++; });
  $("#calSum").innerHTML = `<span class="pill">${filled}/${done} champs remplis</span>`;
}

/* ===== Evening Run Pyramid ===== */
const PYRA = [
  {dist:100, rec:1},
  {dist:200, rec:2},
  {dist:300, rec:3},
  {dist:400, rec:4},
  {dist:500, rec:5},
  {dist:400, rec:4},
  {dist:300, rec:3},
  {dist:200, rec:2},
  {dist:100, rec:null}
];

function buildRun(){
  const root=$("#runSteps"); root.innerHTML="";
  PYRA.forEach((p,i)=>{
    const hasRec = p.rec !== null;
    const row=document.createElement('div');
    row.className="step gridRun";
    row.style.gridTemplateColumns = hasRec ? "1fr auto 90px 100px 100px 100px" : "1fr auto 90px 100px 100px";
    row.innerHTML=`
      <div><div class="s-title">${p.dist} m — Lap ${i+1}</div><div class="s-target">Z4 technique</div></div>
      <div class="lbl">Temps / FC / Cadence</div>
      <input class="s-in" data-id="run_${i}_t" type="number" step="0.01" placeholder="min">
      <input class="s-in" data-id="run_${i}_hr" type="number" step="1" placeholder="bpm">
      <input class="s-in" data-id="run_${i}_cad" type="number" step="1" placeholder="pas/min">
      ${hasRec ? `<input class="s-in" data-id="run_${i}_rec" type="number" step="0.01" placeholder="${p.rec}" title="Récup (min)">` : ""}
    `;
    root.appendChild(row);
  });
}

function sumKeys(d, keys){ return keys.reduce((a,k)=> a + (parseFloat(getVal(d,k))||0), 0); }
function avgKeys(d, keys){
  const vals = keys.map(k => parseFloat(getVal(d,k))).filter(v => !isNaN(v));
  if(!vals.length) return "";
  return vals.reduce((a,b)=>a+b,0)/vals.length;
}
function runRefresh(){
  const d=$("#datePick").value;
  const tKeys = PYRA.map((_,i)=>`run_${i}_t`);
  const rKeys = PYRA.map((p,i)=> p.rec!==null ? `run_${i}_rec` : null).filter(Boolean);
  const hrKeys= PYRA.map((_,i)=>`run_${i}_hr`);
  const cdKeys= PYRA.map((_,i)=>`run_${i}_cad`);

  const tTot = sumKeys(d, tKeys);
  const rTot = sumKeys(d, rKeys);
  const hrAvg= avgKeys(d, hrKeys);
  const cdAvg= avgKeys(d, cdKeys);

  $("#runSum").innerHTML = [
    `<span class="pill">Travail: ${isNaN(tTot)?"0.00":tTot.toFixed(2)} min</span>`,
    `<span class="pill">Récup: ${isNaN(rTot)?"0.00":rTot.toFixed(2)} min</span>`,
    `<span class="pill">FC moy: ${hrAvg===""?"—":Math.round(hrAvg)} bpm</span>`,
    `<span class="pill">Cadence moy: ${cdAvg===""?"—":Math.round(cdAvg)} pas/min</span>`
  ].join(" ");
}

/* ===== Mount / Bind ===== */
function mount(){
  const dp=$("#datePick"); if(!dp.value) dp.value=today();

  // Build sections
  buildCal(); buildRun();

  // Fill existing values and bind change
  document.querySelectorAll('input.s-in').forEach(inp=>{
    const k=inp.dataset.id; inp.value=getVal(dp.value,k);
    inp.onchange = ()=>{
      setVal(dp.value, k, inp.value);
      calRefresh(); runRefresh(); progressRefresh();
    };
  });

  calRefresh(); runRefresh(); progressRefresh();
}

function progressRefresh(){
  const d=$("#datePick").value;
  const allInputs = document.querySelectorAll('input.s-in');
  const total = allInputs.length;
  let filled=0; allInputs.forEach(i=>{ if(i.value!=="") filled++; });
  const pct = Math.round((filled/total)*100);
  $("#progress").style.width = pct+"%";
  $("#progressText").textContent = `Progression : ${filled}/${total} • ${pct}%`;
}

// Export / Reset
function exportCsv(){
  const db=readDB(); const rows=[["date","clé","valeur"]];
  Object.keys(db).sort().forEach(d=>{ Object.keys(db[d]).forEach(k=> rows.push([d,k,db[d][k]])); });
  const csv = rows.map(r=> r.map(v=>{ const s=String(v??""); return /[\",;\n;]/.test(s)?`"${s.replace(/"/g,'""')}"`:s; }).join(";")).join("\n");
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='mercredi_complet.csv'; a.click();
}
function resetDay(){
  const d=$("#datePick").value, db=readDB(); if(!db[d]) return;
  Object.keys(db[d]).forEach(k=> db[d][k]=""); writeDB(db); mount();
}

document.addEventListener('DOMContentLoaded', ()=>{
  $("#datePick").addEventListener('change', mount);
  document.getElementById('exportCsv').addEventListener('click', exportCsv);
  document.getElementById('resetDay').addEventListener('click', resetDay);
  mount();
});
</script>
</body>
</html>
